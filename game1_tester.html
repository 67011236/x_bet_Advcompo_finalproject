<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game1 API Tester - X-BET</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        h1 {
            color: #71ddff;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(113, 221, 255, 0.3);
        }
        .section h2 {
            color: #22c55e;
            margin-top: 0;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #cbd5e0;
        }
        input, select, button {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(113, 221, 255, 0.5);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 16px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #71ddff;
            box-shadow: 0 0 10px rgba(113, 221, 255, 0.3);
        }
        button {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 0;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4);
        }
        button:disabled {
            background: #374151;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #22c55e;
        }
        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }
        .info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #3b82f6;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 14px;
            color: #94a3b8;
        }
        .history-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .win { border-left: 4px solid #22c55e; }
        .lose { border-left: 4px solid #ef4444; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Game1 API Tester</h1>
        
        <!-- Login Section -->
        <div class="section">
            <h2>üîê Authentication</h2>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="loginEmail" value="test@gmail.com" placeholder="Enter your email">
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="loginPassword" value="123456" placeholder="Enter your password">
            </div>
            <button onclick="login()">Login</button>
            <div id="authResult" class="result info" style="display:none;"></div>
        </div>

        <!-- Balance Section -->
        <div class="section">
            <h2>üí∞ Balance Management</h2>
            <button onclick="checkBalance()">Check Balance</button>
            <div class="form-group">
                <label>Deposit Amount:</label>
                <input type="number" id="depositAmount" value="1000" min="1">
            </div>
            <button onclick="deposit()">Deposit Money</button>
            <div id="balanceResult" class="result info" style="display:none;"></div>
        </div>

        <!-- Game Play Section -->
        <div class="section">
            <h2>üé≤ Play Game1</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label>Bet Amount:</label>
                    <input type="number" id="betAmount" value="100" min="1">
                </div>
                <div class="form-group">
                    <label>Selected Color:</label>
                    <select id="selectedColor">
                        <option value="blue">üçÄ Blue</option>
                        <option value="white">üíé White</option>
                    </select>
                </div>
            </div>
            <button onclick="playGame()">üé≤ SPIN THE WHEEL</button>
            <div id="gameResult" class="result" style="display:none;"></div>
        </div>

        <!-- Stats Section -->
        <div class="section">
            <h2>üìä Game Statistics</h2>
            <button onclick="getStats()">Refresh Stats</button>
            <div id="statsContainer" style="display:none;">
                <div class="stats-grid" id="statsGrid"></div>
            </div>
            <div id="statsResult" class="result" style="display:none;"></div>
        </div>

        <!-- History Section -->
        <div class="section">
            <h2>üìú Game History</h2>
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px; margin-bottom: 15px;">
                <button onclick="getHistory()">Refresh History</button>
                <input type="number" id="historyLimit" value="10" min="1" max="50" placeholder="Limit">
            </div>
            <div id="historyContainer" style="display:none;"></div>
            <div id="historyResult" class="result" style="display:none;"></div>
        </div>

        <!-- Auto Test Section -->
        <div class="section">
            <h2>ü§ñ Automated Testing</h2>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px;">
                <input type="number" id="autoTestRounds" value="10" min="1" max="100" placeholder="Rounds">
                <input type="number" id="autoTestBet" value="50" min="1" placeholder="Bet per round">
                <select id="autoTestColor">
                    <option value="random">üé≤ Random</option>
                    <option value="blue">üçÄ Blue Only</option>
                    <option value="white">üíé White Only</option>
                </select>
            </div>
            <button onclick="runAutoTest()" id="autoTestBtn">üöÄ Run Auto Test</button>
            <div id="autoTestResult" class="result" style="display:none;"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let isLoggedIn = false;

        // Utility functions
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.textContent = content;
            element.style.display = 'block';
        }

        function formatJSON(obj) {
            return JSON.stringify(obj, null, 2);
        }

        // Authentication
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                
                if (response.ok) {
                    isLoggedIn = true;
                    showResult('authResult', `‚úÖ Login successful!\n${formatJSON(data)}`, 'success');
                } else {
                    showResult('authResult', `‚ùå Login failed:\n${formatJSON(data)}`, 'error');
                }
            } catch (error) {
                showResult('authResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        // Balance Management
        async function checkBalance() {
            try {
                const response = await fetch(`${API_BASE}/balance`, {
                    credentials: 'include'
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResult('balanceResult', `üí∞ Current Balance: ${data.amount} coins`, 'success');
                } else {
                    showResult('balanceResult', `‚ùå Failed to get balance:\n${formatJSON(data)}`, 'error');
                }
            } catch (error) {
                showResult('balanceResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function deposit() {
            const amount = parseFloat(document.getElementById('depositAmount').value);
            
            try {
                const response = await fetch(`${API_BASE}/deposit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({ amount })
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResult('balanceResult', `‚úÖ Deposit successful!\n${formatJSON(data)}`, 'success');
                } else {
                    showResult('balanceResult', `‚ùå Deposit failed:\n${formatJSON(data)}`, 'error');
                }
            } catch (error) {
                showResult('balanceResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        // Game Play
        async function playGame() {
            const betAmount = parseFloat(document.getElementById('betAmount').value);
            const selectedColor = document.getElementById('selectedColor').value;

            try {
                const response = await fetch(`${API_BASE}/api/game1/play`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        bet_amount: betAmount,
                        selected_color: selectedColor
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    const result = data.result;
                    const resultClass = result.won ? 'success' : 'error';
                    const resultEmoji = result.won ? 'üéâ' : 'üíî';
                    
                    showResult('gameResult', 
                        `${resultEmoji} Game Result:\n` +
                        `Selected: ${selectedColor}\n` +
                        `Result: ${result.result_color}\n` +
                        `${result.won ? 'WON' : 'LOST'}: ${result.win_loss_amount} coins\n` +
                        `Balance: ${result.balance_before} ‚Üí ${result.balance_after}\n` +
                        `Message: ${result.message}`, 
                        resultClass
                    );
                    
                    // Auto refresh stats after playing
                    setTimeout(getStats, 500);
                } else {
                    showResult('gameResult', `‚ùå Game failed:\n${formatJSON(data)}`, 'error');
                }
            } catch (error) {
                showResult('gameResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        // Statistics
        async function getStats() {
            try {
                const response = await fetch(`${API_BASE}/api/game1/stats`, {
                    credentials: 'include'
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    const stats = data.stats;
                    
                    // Create stats grid
                    const statsGrid = document.getElementById('statsGrid');
                    statsGrid.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-value" style="color: #22c55e;">${stats.total_games}</div>
                            <div class="stat-label">Total Games</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: #3b82f6;">${stats.total_wins}</div>
                            <div class="stat-label">Wins</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: #ef4444;">${stats.total_losses}</div>
                            <div class="stat-label">Losses</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: #a855f7;">${stats.win_percentage}%</div>
                            <div class="stat-label">Win Rate</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: #f59e0b;">${stats.total_bet_amount.toFixed(2)}</div>
                            <div class="stat-label">Total Bet</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: ${stats.net_profit_loss >= 0 ? '#22c55e' : '#ef4444'};">
                                ${stats.net_profit_loss >= 0 ? '+' : ''}${stats.net_profit_loss.toFixed(2)}
                            </div>
                            <div class="stat-label">Net P&L</div>
                        </div>
                    `;
                    
                    document.getElementById('statsContainer').style.display = 'block';
                    showResult('statsResult', `‚úÖ Stats updated successfully!`, 'success');
                } else {
                    showResult('statsResult', `‚ùå Failed to get stats:\n${formatJSON(data)}`, 'error');
                }
            } catch (error) {
                showResult('statsResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        // History
        async function getHistory() {
            const limit = parseInt(document.getElementById('historyLimit').value);
            
            try {
                const response = await fetch(`${API_BASE}/api/game1/history?limit=${limit}`, {
                    credentials: 'include'
                });

                const data = await response.json();
                
                if (response.ok && data.success) {
                    const history = data.history;
                    const historyContainer = document.getElementById('historyContainer');
                    
                    if (history.length === 0) {
                        historyContainer.innerHTML = '<p style="text-align: center; color: #94a3b8;">No games played yet.</p>';
                    } else {
                        historyContainer.innerHTML = history.map(game => `
                            <div class="history-item ${game.won ? 'win' : 'lose'}">
                                <div>
                                    <strong>${game.selected_color === 'blue' ? 'üçÄ Blue' : 'üíé White'} ‚Üí ${game.result_color === 'blue' ? 'üçÄ Blue' : 'üíé White'}</strong><br>
                                    <small>${new Date(game.played_at).toLocaleString()}</small>
                                </div>
                                <div style="text-align: center;">
                                    <strong>Bet: ${game.bet_amount}</strong>
                                </div>
                                <div style="text-align: right;">
                                    <strong style="color: ${game.won ? '#22c55e' : '#ef4444'};">
                                        ${game.won ? '+' : ''}${game.win_loss_amount.toFixed(2)}
                                    </strong><br>
                                    <small>${game.won ? 'WIN' : 'LOSE'}</small>
                                </div>
                            </div>
                        `).join('');
                    }
                    
                    historyContainer.style.display = 'block';
                    showResult('historyResult', `‚úÖ Loaded ${history.length} games`, 'success');
                } else {
                    showResult('historyResult', `‚ùå Failed to get history:\n${formatJSON(data)}`, 'error');
                }
            } catch (error) {
                showResult('historyResult', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        // Auto Test
        async function runAutoTest() {
            const rounds = parseInt(document.getElementById('autoTestRounds').value);
            const betAmount = parseFloat(document.getElementById('autoTestBet').value);
            const colorMode = document.getElementById('autoTestColor').value;
            
            const btn = document.getElementById('autoTestBtn');
            btn.disabled = true;
            btn.textContent = 'Running...';
            
            let results = [];
            let wins = 0;
            let losses = 0;
            let totalProfit = 0;
            
            showResult('autoTestResult', `ü§ñ Starting ${rounds} rounds...\n`, 'info');
            
            for (let i = 1; i <= rounds; i++) {
                let selectedColor;
                if (colorMode === 'random') {
                    selectedColor = Math.random() < 0.5 ? 'blue' : 'white';
                } else {
                    selectedColor = colorMode;
                }
                
                try {
                    const response = await fetch(`${API_BASE}/api/game1/play`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        credentials: 'include',
                        body: JSON.stringify({
                            bet_amount: betAmount,
                            selected_color: selectedColor
                        })
                    });

                    const data = await response.json();
                    
                    if (response.ok && data.success) {
                        const result = data.result;
                        results.push(result);
                        
                        if (result.won) {
                            wins++;
                        } else {
                            losses++;
                        }
                        totalProfit += result.win_loss_amount;
                        
                        // Update progress
                        const progress = `Round ${i}/${rounds}: ${selectedColor} ‚Üí ${result.result_color} = ${result.won ? 'WIN' : 'LOSE'} (${result.win_loss_amount})`;
                        showResult('autoTestResult', 
                            document.getElementById('autoTestResult').textContent + progress + '\n', 
                            'info'
                        );
                        
                        // Small delay to not overwhelm the server
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                } catch (error) {
                    console.error(`Round ${i} failed:`, error);
                }
            }
            
            // Final summary
            const winRate = (wins / rounds * 100).toFixed(2);
            const summary = `\nüéØ AUTO TEST COMPLETED!\n` +
                           `Rounds: ${rounds}\n` +
                           `Wins: ${wins} (${winRate}%)\n` +
                           `Losses: ${losses}\n` +
                           `Net Profit: ${totalProfit.toFixed(2)} coins\n` +
                           `Average per round: ${(totalProfit / rounds).toFixed(2)} coins`;
            
            showResult('autoTestResult', 
                document.getElementById('autoTestResult').textContent + summary, 
                totalProfit >= 0 ? 'success' : 'error'
            );
            
            btn.disabled = false;
            btn.textContent = 'üöÄ Run Auto Test';
            
            // Refresh stats
            setTimeout(getStats, 500);
        }

        // Initialize
        window.onload = function() {
            showResult('authResult', 'Please login first to start testing', 'info');
        };
    </script>
</body>
</html>